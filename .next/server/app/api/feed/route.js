"use strict";(()=>{var e={};e.id=749,e.ids=[749],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},95959:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>k,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var r={};s.r(r),s.d(r,{GET:()=>l});var a=s(49303),n=s(88716),i=s(60670),o=s(87070),u=s(43949);async function l(e){try{let t;let{searchParams:s}=new URL(e.url),r=s.get("userId"),a=s.get("type")||"fyp",n=parseInt(s.get("page")||"1"),i=parseInt(s.get("limit")||"10"),l=(n-1)*i;if(!r)return o.NextResponse.json({error:"User ID is required"},{status:400});switch(a){case"friends":t=await u._.post.findMany({where:{userId:{in:await c(r)},isPublic:!0},include:{user:{select:{id:!0,name:!0,username:!0,image:!0,avatarConfig:!0}},likes:!0,comments:!0,saves:!0,_count:{select:{likes:!0,comments:!0,saves:!0}}},orderBy:{createdAt:"desc"},take:i,skip:l});break;case"trending":t=await u._.post.findMany({where:{isPublic:!0,createdAt:{gte:new Date(Date.now()-6048e5)}},include:{user:{select:{id:!0,name:!0,username:!0,image:!0,avatarConfig:!0}},likes:!0,comments:!0,saves:!0,_count:{select:{likes:!0,comments:!0,saves:!0}}},orderBy:[{likes:{_count:"desc"}},{comments:{_count:"desc"}},{createdAt:"desc"}],take:i,skip:l});break;default:t=await d(r,i,l)}let p=t.map(e=>({...e,isLiked:e.likes?.some(e=>e.userId===r)||!1,isSaved:e.saves?.some(e=>e.userId===r)||!1,engagementScore:function(e){let t=e._count?.likes||0,s=e._count?.comments||0;return 1*t+3*s+2*(e._count?.saves||0)}(e)}));return o.NextResponse.json({posts:p,hasMore:t.length===i,nextPage:n+1})}catch(e){return console.error("Error fetching feed:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){return(await u._.follows.findMany({where:{followerId:e},select:{followingId:!0}})).map(e=>e.followingId)}async function d(e,t,s){let r=await u._.user.findUnique({where:{id:e},include:{likes:{include:{post:!0}},saves:{include:{post:!0}}}});if(!r)return[];let a=[...new Set([...r.likes.flatMap(e=>e.post.tags),...r.saves.flatMap(e=>e.post.tags)])];return await u._.post.findMany({where:{isPublic:!0,userId:{not:e},OR:[{tags:{hasSome:a}},{style:{in:r.likes.map(e=>e.post.style).filter(e=>!!e)}}]},include:{user:{select:{id:!0,name:!0,username:!0,image:!0,avatarConfig:!0}},likes:!0,comments:!0,saves:!0,_count:{select:{likes:!0,comments:!0,saves:!0}}},orderBy:{createdAt:"desc"},take:t,skip:s})}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/feed/route",pathname:"/api/feed",filename:"route",bundlePath:"app/api/feed/route"},resolvedPagePath:"/Users/ronak/Downloads/fitzy_01/Fitzty/src/app/api/feed/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=p,k="/api/feed/route";function w(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},43949:(e,t,s)=>{s.d(t,{_:()=>a});let r=require("@prisma/client"),a=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972],()=>s(95959));module.exports=r})();